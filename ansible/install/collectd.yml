---
#
# Playbook to install collectd on undercloud/overcloud
#

- hosts: undercloud
  remote_user: "{{ local_remote_user }}"
  roles:
    - { role: common, when: collectd_undercloud }
    - { role: collectd, when: collectd_undercloud }
  tasks:
    - name: Collectd off if not collectd_undercloud
      service: name=collectd state=stopped enabled=false
      become: true
      when: not collectd_undercloud

- hosts: controller
  remote_user: "{{ host_remote_user }}"
  roles:
    - { role: common, when: collectd_controller }
    - { role: collectd, when: collectd_controller }
  tasks:
    - name: Collectd off if not collectd_controller
      service: name=collectd state=stopped enabled=false
      become: true
      when: not collectd_controller

- hosts: ceph
  remote_user: "{{ host_remote_user }}"
  roles:
    - { role: common, when: collectd_ceph }
    - { role: collectd, when: collectd_ceph }
  tasks:
    - name: Collectd off if not collectd_ceph
      service: name=collectd state=stopped enabled=false
      become: true
      when: not collectd_ceph

- hosts: compute
  remote_user: "{{ host_remote_user }}"
  roles:
    - { role: common, when: collectd_compute }
    - { role: collectd, when: collectd_compute }
  tasks:
    - name: Collectd off if not collectd_compute
      service: name=collectd state=stopped enabled=false
      become: true
      when: not collectd_compute
